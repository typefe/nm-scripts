#!/bin/bash
#/etc/NetworkManager/dispatcher.d/ibbwifi-login

# Get the network interface and state
INTERFACE="$1"
STATE="$2"

# Check if the interface is in the 'up' state
if [[ "$STATE" == "up" ]]; then
    # Get the connected SSID
    SSID=$(nmcli -t -f active,ssid dev wifi | awk -F: '/^yes/ {print $2}')
    
    # Check if the connected SSID is 'ibbWiFi'
    if [[ "$SSID" == "ibbWiFi" ]]; then
        echo "$(date): Connected to ibbWiFi on $INTERFACE. Running script..." >> /var/log/ibbwifi-autologin.log
        /usr/local/bin/warp_captive_login.sh
    else
        echo "$(date): Connected to $SSID on $INTERFACE. No action required." >> /var/log/ibbwifi-autologin.log
    fi
fi

